<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-title class="animate__animated animate__backInDown">
      Lista de Compras
    </ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="openSettings()">
        <ion-icon name="settings"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  
  <!-- Mensagem quando não há produtos -->
  <div *ngIf="tarefaCollection.length === 0" class="empty-state">
    <ion-card>
      <ion-card-content class="ion-text-center">
        <ion-icon name="basket-outline" size="large" color="medium"></ion-icon>
        <h2>Lista Vazia</h2>
        <p>Sua lista de compras está vazia. Adicione alguns produtos para começar!</p>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Lista de produtos -->
  <ion-list class="animate__animated animate__bounceInUp" *ngIf="tarefaCollection.length > 0">
    <ion-item-sliding *ngFor="let item of tarefaCollection; trackBy: trackByFn">
      <ion-item (click)="openActions(item)">
        <ion-label>
          <h2 [class.completed]="item.feito">
            <strong>{{item.tarefa}}</strong>
          </h2>
          <div class="item-details">
            <p class="text-quantidade">Qtd: {{item.quantidade}}</p>
            <p class="text-valor" *ngIf="item.valorUnitario > 0">
              Unit: {{formatarMoeda(item.valorUnitario)}}
            </p>
            <p class="text-subtotal" *ngIf="item.valorUnitario > 0">
              <strong>Subtotal: {{formatarMoeda(calcularSubtotal(item))}}</strong>
            </p>
          </div>
          <p class="text-p" [ngClass]="{'status-success': item.feito, 'status-pending': !item.feito}">
            {{item.feito ? 'Adicionado no Carrinho' : 'Não Adicionado no Carrinho'}}
          </p>
        </ion-label>
        <ion-icon 
          slot="start" 
          [name]="item.feito ? 'checkmark-circle' : 'information-circle'" 
          [color]="item.feito ? 'success' : 'danger'">
        </ion-icon>
      </ion-item>
      
      <ion-item-options side="end">
        <ion-item-option color="danger" (click)="delete(item)">
          <ion-icon name="trash-outline"></ion-icon>
          Excluir
        </ion-item-option>
      </ion-item-options>
    </ion-item-sliding>
  </ion-list>

  <!-- Rodapé com totais -->
  <ion-card *ngIf="tarefaCollection.length > 0 && getTotalGeral() > 0" class="totals-card">
    <ion-card-header>
      <ion-card-title class="totals-title">
        <ion-icon name="calculator-outline"></ion-icon>
        Resumo dos Gastos
      </ion-card-title>
    </ion-card-header>
    <ion-card-content class="totals-content">
      <!-- <div class="total-row">
        <span class="total-label">Pendente:</span>
        <span class="total-value pending">{{formatarMoeda(getTotalPendente())}}</span>
      </div> -->
      <!-- <div class="total-row">
        <span class="total-label">Já Comprado:</span>
        <span class="total-value success">{{formatarMoeda(getTotalComprado())}}</span>
      </div> -->
      <ion-item class="total-geral">
        <ion-label>
          <h2><strong>Total Comprado</strong></h2>
        </ion-label>
        <ion-note slot="end" class="total-geral-value">
          <strong>{{formatarMoeda(getTotalComprado())}}</strong>
        </ion-note>
      </ion-item>
    </ion-card-content>
  </ion-card>

  <!-- Floating Action Buttons -->
  
  <!-- Botão PIX (topo) -->
  <ion-fab vertical="top" horizontal="end" slot="fixed">
    <ion-fab-button (click)="showPix()" color="success" class="animate__animated animate__bounce" size="small">
      <ion-icon name="cash-outline"></ion-icon>
    </ion-fab-button>
  </ion-fab>
  
  <!-- Botão Tour (ao lado do Excluir Todos) -->
  <ion-fab vertical="bottom" horizontal="start" slot="fixed" style="left: 3%;">
    <ion-fab-button (click)="restartTour()" color="tertiary" class="animate__animated animate__bounce" size="small">
      <ion-icon name="help-circle-outline"></ion-icon>
    </ion-fab-button>
  </ion-fab>
  
  <!-- Botão Adicionar (principal) -->
  <ion-fab vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button (click)="showAdd()" color="primary" class="animate__animated animate__bounce">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>
  
  <!-- Botão Excluir Todos (só aparece quando há itens) -->
  <ion-fab vertical="bottom" horizontal="start" slot="fixed" *ngIf="tarefaCollection.length > 0">
    <ion-fab-button (click)="showExclusion()" color="danger" class="animate__animated animate__bounce" size="small">
      <ion-icon name="trash-outline"></ion-icon>
    </ion-fab-button>
  </ion-fab>

  <!-- Componente de Tour -->
  <app-tour-overlay></app-tour-overlay>

</ion-content>