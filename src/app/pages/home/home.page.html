<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-title class="animate__animated animate__backInDown">
      Lista de Compras
    </ion-title>
    <ion-buttons slot="end">
      <!-- <ion-button (click)="openHistorico()">
        <ion-icon name="analytics-outline"></ion-icon>
      </ion-button> -->
      <ion-button (click)="openSettings()">
        <ion-icon name="settings"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  
  <!-- Cards de a√ß√µes r√°pidas -->
  <div class="quick-actions-container">
    <div class="quick-actions-scroll">
      <!-- Card: Adicionar Produto -->
      <div class="action-card" (click)="showAdd()">
        <div class="action-card-icon">
          <ion-icon name="add-circle-outline"></ion-icon>
        </div>
        <div class="action-card-content">
          <h3>Adicionar</h3>
          <p>Novo produto na Lista</p>
        </div>
      </div>

      <!-- Card: Hist√≥rico -->
      <div class="action-card" (click)="openHistorico()">
        <div class="action-card-icon">
          <ion-icon name="analytics-outline"></ion-icon>
        </div>
        <div class="action-card-content">
          <h3>Hist√≥rico</h3>
          <p>Ver compras</p>
        </div>
      </div>

      <!-- Card: Estat√≠sticas (fict√≠cio) -->
      <div class="action-card" (click)="showComingSoon('Estat√≠sticas')">
        <div class="action-card-icon">
          <ion-icon name="bar-chart-outline"></ion-icon>
        </div>
        <div class="action-card-content">
          <h3>Estat√≠sticas</h3>
          <p>Ver dados</p>
        </div>
      </div>

      <!-- Card: Categorias (fict√≠cio) -->
      <div class="action-card" (click)="showComingSoon('Categorias')">
        <div class="action-card-icon">
          <ion-icon name="pricetags-outline"></ion-icon>
        </div>
        <div class="action-card-content">
          <h3>Categorias</h3>
          <p>Organizar</p>
        </div>
      </div>

      <!-- Card: Favoritos (fict√≠cio) -->
      <div class="action-card" (click)="showComingSoon('Favoritos')">
        <div class="action-card-icon">
          <ion-icon name="heart-outline"></ion-icon>
        </div>
        <div class="action-card-content">
          <h3>Favoritos</h3>
          <p>Mais comprados</p>
        </div>
      </div>

      <!-- Card: Compartilhar (fict√≠cio) -->
      <div class="action-card" (click)="showComingSoon('Compartilhar')">
        <div class="action-card-icon">
          <ion-icon name="share-social-outline"></ion-icon>
        </div>
        <div class="action-card-content">
          <h3>Compartilhar</h3>
          <p>Enviar lista</p>
        </div>
      </div>

      <!-- Card: Calculadora (fict√≠cio) -->
      <div class="action-card" (click)="showComingSoon('Calculadora')">
        <div class="action-card-icon">
          <ion-icon name="calculator-outline"></ion-icon>
        </div>
        <div class="action-card-content">
          <h3>Calculadora</h3>
          <p>Or√ßamento</p>
        </div>
      </div>

      <!-- Card: Configura√ß√µes -->
      <div class="action-card" (click)="openSettings()">
        <div class="action-card-icon">
          <ion-icon name="settings-outline"></ion-icon>
        </div>
        <div class="action-card-content">
          <h3>Configura√ß√µes</h3>
          <p>Ajustes</p>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Mensagem quando n√£o h√° produtos -->
  <div *ngIf="tarefaCollection.length === 0" class="empty-state">
    <ion-card>
      <ion-card-content class="ion-text-center">
        <ion-icon name="basket-outline" size="large" color="medium"></ion-icon>
        <h2>Lista Vazia</h2>
        <p>Sua lista de compras est√° vazia. Adicione alguns produtos para come√ßar!</p>
      </ion-card-content>
    </ion-card>
  </div>

  <ion-card *ngIf="isListaCompleta()" class="complete-notification">
    <ion-card-content class="ion-text-center">
      <ion-icon name="checkmark-circle" size="large" color="success"></ion-icon>
      <h2>Lista Conclu√≠da! üéâ</h2>
      <p>Voc√™ completou todos os itens da sua lista. Que tal arquiv√°-la no hist√≥rico?</p>
      <ion-button (click)="arquivarLista()" fill="solid" color="success">
        <ion-icon name="archive-outline" slot="start"></ion-icon>
        Arquivar Lista
      </ion-button>
    </ion-card-content>
  </ion-card>

  <!-- Lista de produtos -->
  <ion-list class="animate__animated animate__bounceInUp" *ngIf="tarefaCollection.length > 0">
    <ion-item-sliding *ngFor="let item of tarefaCollection; trackBy: trackByFn">
      <ion-item (click)="openActions(item)">
        <ion-label>
          <h2 [class.completed]="item.feito">
            <strong>{{item.tarefa}}</strong>
          </h2>
          <div class="item-details">
            <p class="text-quantidade">Qtd: {{item.quantidade}}</p>
            <p class="text-valor" *ngIf="item.valorUnitario > 0">
              Unit: {{formatarMoeda(item.valorUnitario)}}
            </p>
            <p class="text-subtotal" *ngIf="item.valorUnitario > 0">
              <strong>Subtotal: {{formatarMoeda(calcularSubtotal(item))}}</strong>
            </p>
          </div>
          <p class="text-p" [ngClass]="{'status-success': item.feito, 'status-pending': !item.feito}">
            {{item.feito ? 'Adicionado no Carrinho' : 'N√£o Adicionado no Carrinho'}}
          </p>
        </ion-label>
        <ion-icon 
          slot="start" 
          [name]="item.feito ? 'checkmark-circle' : 'information-circle'" 
          [color]="item.feito ? 'success' : 'warning'">
        </ion-icon>
      </ion-item>
      
      <ion-item-options side="end">
        <ion-item-option color="danger" (click)="delete(item)">
          <ion-icon name="trash-outline"></ion-icon>
          Excluir
        </ion-item-option>
      </ion-item-options>
    </ion-item-sliding>
  </ion-list>

  <!-- Rodap√© com totais -->
  <ion-card *ngIf="tarefaCollection.length > 0 && getTotalGeral() > 0" class="totals-card">
    <ion-card-header>
      <ion-card-title class="totals-title">
        <ion-icon name="calculator-outline"></ion-icon>
        Resumo dos Gastos
      </ion-card-title>
    </ion-card-header>
    <ion-card-content class="totals-content">
      <ion-item class="total-geral">
        <ion-label>
          <h2><strong>Total Comprado</strong></h2>
        </ion-label>
        <ion-note slot="end" class="total-geral-value">
          <strong>{{formatarMoeda(getTotalComprado())}}</strong>
        </ion-note>
      </ion-item>
    </ion-card-content>
  </ion-card>

  <!-- Floating Action Buttons -->
  
  <!-- Bot√£o Tour (ao lado do Excluir Todos) -->
   
  <ion-fab *ngIf="!tourService.isTourCompletedOnce()" vertical="bottom" horizontal="start" slot="fixed" style="left: 3%; margin-bottom: 10px;">
    <ion-fab-button (click)="restartTour()" color="tertiary" class="animate__animated animate__bounce" size="small">
      <ion-icon name="help-circle-outline"></ion-icon>
    </ion-fab-button>
  </ion-fab>
  
  <!-- Bot√£o Adicionar (principal) -->
  <ion-fab vertical="bottom" horizontal="end" slot="fixed" style="margin-bottom: 10px;">
    <ion-fab-button (click)="showAdd()" color="primary" class="animate__animated animate__bounce">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>
  
  <!-- Bot√£o Excluir Todos (s√≥ aparece quando h√° itens) -->
  <ion-fab vertical="bottom" horizontal="start" slot="fixed" *ngIf="tarefaCollection.length > 0" style="margin-bottom: 10px;">
    <ion-fab-button (click)="showExclusion()" color="danger" class="animate__animated animate__bounce" size="small">
      <ion-icon name="trash-outline"></ion-icon>
    </ion-fab-button>
  </ion-fab>

  <!-- Componente de Tour -->
  <app-tour-overlay></app-tour-overlay>

</ion-content>